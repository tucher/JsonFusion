<!doctype html>
<meta charset="utf-8" />
<body>
  <textarea id="src" style="width:100%;height:40vh;">
int main() { return 0 }
  </textarea>
  <button id="run">Run -fsyntax-only</button>
  <pre id="out"></pre>

  <script type="module">
    import { init, Wasmer, Directory } from "https://unpkg.com/@wasmer/sdk@latest/dist/index.mjs";

    const out = document.getElementById("out");
    const log = (s) => (out.textContent += s + "\n");

    await init();

    // Pull clang package (big download; first run is slow)
    const clangPkg = await Wasmer.fromRegistry("clang/clang"); // per Wasmer example  [oai_citation:1â€¡Wasmer](https://wasmer.io/posts/clang-in-browser)

    document.getElementById("run").onclick = async () => {
      out.textContent = "";
      const project = new Directory();
      await project.writeFile("input.c", document.getElementById("src").value);

      // -fsyntax-only, no output file
      const inst = await clangPkg.entrypoint.run({
        args: ["-fsyntax-only", "-Wall", "/project/input.c"],
        mount: { "/project": project },
      });

      const result = await inst.wait();
      log(result.stdout || "");
      log(result.stderr || "");
      log(result.ok ? "OK" : `FAILED (exit ${result.code})`);
    };
  </script>
</body>
